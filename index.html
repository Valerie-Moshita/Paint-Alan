<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Paint por N√∫meros</title>
  <style>
    body {
      font-family: Arial, "Comic Sans MS", sans-serif;
      background: #f4f6f8;
      margin: 0;
      display: flex;
      height: 100vh;
    }
    #sidebar {
      width: 260px;
      background: #fff;
      border-right: 2px solid #ccc;
      padding: 15px;
      box-sizing: border-box;
      overflow-y: auto;
    }
    #gallery {
      width: 220px;
      background: #fff;
      border-left: 2px solid #ccc;
      padding: 15px;
      box-sizing: border-box;
      overflow-y: auto;
      text-align: center;
    }
    #main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px;
    }

    h1 { font-size: 20px; margin-bottom: 10px; text-align: center; }

    #controls { margin-bottom: 12px; text-align: center; }
    #controls button, #controls input[type="file"] {
      display: block;
      margin: 8px auto;
      padding: 8px 10px;
      cursor: pointer;
      border: none;
      background: #4a90e2;
      color: white;
      border-radius: 4px;
      font-size: 14px;
      text-align: center;
    }
    #controls button:hover { background: #357ABD; }
    #palette {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      justify-items: center;
      margin-top: 8px;
    }
    #palette button {
      width: 28px;
      height: 28px;
      border: 2px solid #222;
      cursor: pointer;
      padding: 0;
    }
    #selectedColor { margin-top: 12px; text-align: center; font-weight: bold; }
    #selectedColor span {
      display:inline-block; width:20px; height:20px; border:1px solid #000; vertical-align:middle;
    }

    #canvas { border: 2px solid #333; background: #fff; cursor: crosshair; max-width:100%; }

    .thumb { width: 100%; margin: 10px 0; border: 2px solid #ccc; border-radius: 6px; cursor: pointer; transition: transform .18s, border .18s, opacity .18s; }
    .thumb:hover { transform: scale(1.03); border: 2px solid #4a90e2; }
    .thumb.disabled { opacity: 0.45; pointer-events: none; border: 2px solid #aaa; transform: none; }
    .thumb.selected { border: 3px solid #2E8B57; }

    .hidden { display: none; }
  </style>
</head>
<body>
  <div id="sidebar">
    <h1>Paint por N√∫meros</h1>

    <div id="controls">
      <button id="btnReset">üîÑ Limpiar</button>
      <button id="btnUndo">‚Ü©Ô∏è Deshacer</button>
      <button id="btnDownload">‚¨áÔ∏è Descargar</button>

      <button id="btnTeacher">üë©‚Äçüè´ Modo Maestro</button>
      <input type="file" id="fileInput" accept=".png,.jpg,.jpeg,.svg" class="hidden" multiple />

      <h3 style="margin-top:10px;">üé® Paleta</h3>
      <div id="palette"></div>
      <div id="selectedColor">Color actual: <span id="colorBox"></span></div>
    </div>
  </div>

  <div id="main">
    <canvas id="canvas" width="800" height="600"></canvas>
  </div>

  <div id="gallery">
    <h3>Elige una imagen</h3>
    <div id="galleryImgs">
      <!-- im√°genes cargadas aparecer√°n aqu√≠ -->
    </div>
  </div>

<script>
/* ---------- Elementos ---------- */
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

const btnReset = document.getElementById('btnReset');
const btnUndo = document.getElementById('btnUndo');
const btnDownload = document.getElementById('btnDownload');
const btnTeacher = document.getElementById('btnTeacher');
const fileInput = document.getElementById('fileInput');

const paletteEl = document.getElementById('palette');
const colorBox = document.getElementById('colorBox');
const galleryImgs = document.getElementById('galleryImgs');

/* ---------- Estado ---------- */
let currentColor = 'red';
let originalImage = null; // Image object used as base
let history = [];
const MAX_HISTORY = 12;
let teacherMode = false;

/* ---------- Paleta ---------- */
const colors = [
  'red','crimson','firebrick','salmon','lightcoral',
  'orange','darkorange','coral','tomato','chocolate',
  'gold','yellow','khaki','lightyellow','beige',
  'lime','green','darkgreen','seagreen','olive',
  'cyan','skyblue','deepskyblue','blue','navy',
  'violet','orchid','plum','purple','indigo',
  'pink','hotpink','deeppink','palevioletred','magenta',
  'brown','sienna','peru','gray','dimgray',
  'black','white','silver','lightgray'
];
colorBox.style.background = currentColor;
colors.forEach(c => {
  const b = document.createElement('button');
  b.style.background = c;
  b.title = c;
  b.addEventListener('click', () => {
    currentColor = c;
    colorBox.style.background = c;
  });
  paletteEl.appendChild(b);
});

/* ---------- Historial (undo) ---------- */
function saveState() {
  try {
